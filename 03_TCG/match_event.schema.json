{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Match Event",
  "type": "object",
  "required": [
    "evt_id",
    "match_id",
    "seq",
    "type",
    "payload",
    "server_ts"
  ],
  "properties": {
    "evt_id": {
      "type": "string",
      "minLength": 1
    },
    "match_id": {
      "type": "string",
      "minLength": 1
    },
    "seq": {
      "type": "integer",
      "minimum": 0
    },
    "type": {
      "type": "string",
      "minLength": 1,
      "description": "Event type. Must match canonical event vocabulary (see 03_TCG/AUTHORING/MATCH/CONTRACTS.md).",
      "enum": [
        "MATCH_CREATED",
        "MATCH_STARTED",
        "SETUP_REQUIRED",
        "CARD_DRAWN",
        "ENERGY_ATTACHED",
        "ENERGY_POOLED",
        "CARD_SUMMONED",
        "CARD_EVOLVED",
        "CARD_PLAYED_ITEM",
        "CARD_PLAYED_RELIC",
        "TERRAIN_CHANGED",
        "SWITCHED",
        "ATTACK_DECLARED",
        "DAMAGE_APPLIED",
        "STATUS_APPLIED",
        "KO",
        "HAND_DISCARD",
        "TURN_ENDED",
        "MATCH_ENDED",
        "COMMAND_REJECTED",
        "STATE_SNAPSHOT",
        "CHOICE_PROMPTED",
        "CHOICE_RESOLVED",
        "EFFECT_ACTIVATED",
        "EFFECT_RESOLVED",
        "EFFECT_FAILED"
      ]
    },
    "payload": {
      "type": "object"
    },
    "server_ts": {
      "type": "string",
      "format": "date-time"
    },
    "state_hash": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "Hash of canonical state after applying this event."
    },
    "rng": {
      "type": "object",
      "properties": {
        "used": {
          "type": "boolean"
        },
        "commit": {
          "type": "string"
        },
        "reveal": {
          "type": "string"
        },
        "trace": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "audience": {
      "type": "string",
      "enum": [
        "ALL",
        "P1",
        "P2"
      ],
      "description": "Intended recipient audience. Use ALL for public events."
    },
    "redacted": {
      "type": "boolean",
      "description": "If true, payload has been redacted for the audience."
    }
  },
  "additionalProperties": false
}